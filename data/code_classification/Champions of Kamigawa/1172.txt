public class NaturesWill extends CardImpl {°Ïpublic NaturesWill(UUID ownerId) {°Ïsuper(ownerId, 230, "Nature's Will", Rarity.RARE, new CardType[]{CardType.ENCHANTMENT}, "{2}{G}{G}");°Ïthis.expansionSetCode = "CHK";°Ïthis.addAbility(new NaturesWillTriggeredAbility());°Ï}°Ïpublic NaturesWill(final NaturesWill card) {°Ïsuper(card);°Ï}°Ï@Override°Ïpublic NaturesWill copy() {°Ïreturn new NaturesWill(this);°Ï}°Ï}°Ïclass NaturesWillTriggeredAbility extends TriggeredAbilityImpl {°Ïprivate boolean madeDamge = false;°Ïprivate Set<UUID> damagedPlayers = new HashSet<UUID>();°Ïpublic NaturesWillTriggeredAbility() {°Ïsuper(Zone.BATTLEFIELD, new NaturesWillEffect(), false);°Ï}°Ïpublic NaturesWillTriggeredAbility(final NaturesWillTriggeredAbility ability) {°Ïsuper(ability);°Ïthis.madeDamge = ability.madeDamge;°Ïthis.damagedPlayers = new HashSet<UUID>();°Ïthis.damagedPlayers.addAll(ability.damagedPlayers);°Ï}°Ï@Override°Ïpublic NaturesWillTriggeredAbility copy() {°Ïreturn new NaturesWillTriggeredAbility(this);°Ï}°Ï@Override°Ïpublic boolean checkEventType(GameEvent event, Game game) {°Ïreturn event.getType() == EventType.DAMAGED_PLAYER || event.getType() == EventType.COMBAT_DAMAGE_STEP_POST;°Ï}°Ï@Override°Ïpublic boolean checkTrigger(GameEvent event, Game game) {°Ïif (event.getType() == EventType.DAMAGED_PLAYER) {°ÏDamagedPlayerEvent damageEvent = (DamagedPlayerEvent) event;°ÏPermanent p = game.getPermanent(event.getSourceId());°Ïif (damageEvent.isCombatDamage() && p != null && p.getControllerId().equals(this.getControllerId())) {°ÏmadeDamge = true;°ÏdamagedPlayers.add(event.getPlayerId());°Ï}°Ï}°Ïif (event.getType().equals(EventType.COMBAT_DAMAGE_STEP_POST)) {°Ïif (madeDamge) {°ÏSet<UUID> damagedPlayersCopy = new HashSet<UUID>();°ÏdamagedPlayersCopy.addAll(damagedPlayers);°Ïfor(Effect effect: this.getEffects()) {°Ïeffect.setValue("damagedPlayers", damagedPlayersCopy);°Ï}°ÏdamagedPlayers.clear();°ÏmadeDamge = false;°Ïreturn true;°Ï}°Ï}°Ïreturn false;°Ï}°Ï@Override°Ïpublic String getRule() {°Ïreturn "Whenever one or more creatures you control deal combat damage to a player, " + super.getRule();°Ï}°Ï}°Ïclass NaturesWillEffect extends OneShotEffect {°Ïpublic NaturesWillEffect() {°Ïsuper(Outcome.Benefit);°Ïthis.staticText = "tap all lands that player controls and untap all lands you control";°Ï}°Ïpublic NaturesWillEffect(final NaturesWillEffect effect) {°Ïsuper(effect);°Ï}°Ï@Override°Ïpublic NaturesWillEffect copy() {°Ïreturn new NaturesWillEffect(this);°Ï}°Ï@Override°Ïpublic boolean apply(Game game, Ability source) {°ÏSet<UUID> damagedPlayers = (HashSet<UUID>) this.getValue("damagedPlayers");°Ïif (damagedPlayers == null) {°Ïreturn false;°Ï}°ÏFilterLandPermanent filter = new FilterLandPermanent();°ÏList<Permanent> lands = game.getBattlefield().getActivePermanents(filter, source.getControllerId(), source.getSourceId(), game);°Ïfor (Permanent land : lands) {°Ïif (damagedPlayers.contains(land.getControllerId())) {°Ïland.tap(game);°Ï} else if (land.getControllerId().equals(source.getControllerId())) {°Ïland.untap(game);°Ï}°Ï}°Ïreturn false;°Ï}°Ï}°Ï
