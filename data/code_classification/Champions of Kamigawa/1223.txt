public class ShellOfTheLastKappa extends CardImpl {°Ïprivate static final FilterSpell filter = new FilterSpell("instant or sorcery spell that targets you");°Ïstatic {°Ïfilter.add(new TargetYouPredicate());°Ïfilter.add(Predicates.or(new CardTypePredicate(CardType.INSTANT), new CardTypePredicate(CardType.SORCERY)));°Ï}°Ïpublic ShellOfTheLastKappa(UUID ownerId) {°Ïsuper(ownerId, 269, "Shell of the Last Kappa", Rarity.RARE, new CardType[]{CardType.ARTIFACT}, "{3}");°Ïthis.expansionSetCode = "CHK";°Ïthis.supertype.add("Legendary");°ÏAbility ability = new SimpleActivatedAbility(Zone.BATTLEFIELD, new ShellOfTheLastKappaEffect(), new ManaCostsImpl("{3}"));°Ïability.addCost(new TapSourceCost());°ÏTarget target = new TargetSpell(filter);°Ïability.addTarget(target);°Ïthis.addAbility(ability);°Ïability = new SimpleActivatedAbility(Zone.BATTLEFIELD, new ShellOfTheLastKappaCastEffect(), new ManaCostsImpl("{3}"));°Ïability.addCost(new TapSourceCost());°Ïability.addCost(new SacrificeSourceCost());°Ïthis.addAbility(ability);°Ï}°Ïpublic ShellOfTheLastKappa(final ShellOfTheLastKappa card) {°Ïsuper(card);°Ï}°Ï@Override°Ïpublic ShellOfTheLastKappa copy() {°Ïreturn new ShellOfTheLastKappa(this);°Ï}°Ï}°Ïclass ShellOfTheLastKappaEffect extends OneShotEffect {°Ïpublic ShellOfTheLastKappaEffect() {°Ïsuper(Outcome.Exile);°Ïthis.staticText = "Exile target instant or sorcery spell that targets you";°Ï}°Ïpublic ShellOfTheLastKappaEffect(final ShellOfTheLastKappaEffect effect) {°Ïsuper(effect);°Ï}°Ï@Override°Ïpublic ShellOfTheLastKappaEffect copy() {°Ïreturn new ShellOfTheLastKappaEffect(this);°Ï}°Ï@Override°Ïpublic boolean apply(Game game, Ability source) {°ÏSpell spell = game.getStack().getSpell(targetPointer.getFirst(game, source));°Ïif (spell != null) {°ÏPermanent sourcePermanent = game.getPermanent(source.getSourceId());°Ïif (sourcePermanent == null) {°ÏsourcePermanent = (Permanent) game.getLastKnownInformation(source.getSourceId(), Zone.BATTLEFIELD);°Ï}°Ïif (sourcePermanent != null) {°Ïgame.getStack().counter(spell.getId(), source.getSourceId(), game);°ÏCard card = spell.getCard();°Ïcard.moveToExile(CardUtil.getCardExileZoneId(game, source), sourcePermanent.getName(), id, game);°Ï}°Ï}°Ïreturn false;°Ï}°Ï}°Ïclass ShellOfTheLastKappaCastEffect extends OneShotEffect {°Ïpublic ShellOfTheLastKappaCastEffect() {°Ïsuper(Outcome.PlayForFree);°Ïthis.staticText = "You may cast a card exiled with {this} without paying its mana cost";°Ï}°Ïpublic ShellOfTheLastKappaCastEffect(final ShellOfTheLastKappaCastEffect effect) {°Ïsuper(effect);°Ï}°Ï@Override°Ïpublic ShellOfTheLastKappaCastEffect copy() {°Ïreturn new ShellOfTheLastKappaCastEffect(this);°Ï}°Ï@Override°Ïpublic boolean apply(Game game, Ability source) {°ÏPlayer controller = game.getPlayer(source.getControllerId());°Ïif (controller != null) {°ÏTargetCardInExile target = new TargetCardInExile(new FilterCard(), CardUtil.getCardExileZoneId(game, source));°Ïif (controller.choose(Outcome.PlayForFree, game.getExile().getExileZone(CardUtil.getCardExileZoneId(game, source)), target, game)) {°ÏCard card = game.getCard(target.getFirstTarget());°Ïif (card != null) {°Ïgame.getExile().removeCard(card, game);°Ïreturn controller.cast(card.getSpellAbility(), game, true);°Ï}°Ï}°Ï}°Ïreturn false;°Ï}°Ï}°Ïclass TargetYouPredicate implements ObjectPlayerPredicate<ObjectPlayer<StackObject>> {°Ï@Override°Ïpublic boolean apply(ObjectPlayer<StackObject> input, Game game) {°ÏUUID controllerId = input.getPlayerId();°Ïif (controllerId == null) {°Ïreturn false;°Ï}°Ïfor (Target target : input.getObject().getStackAbility().getTargets()) {°Ïfor (UUID targetId : target.getTargets()) {°Ïif (controllerId.equals(targetId)) {°Ïreturn true;°Ï}°Ï}°Ï}°Ïreturn false;°Ï}°Ï@Override°Ïpublic String toString() {°Ïreturn "spell that targets you";°Ï}°Ï}°Ï
