public class VolrathsCurse extends CardImpl {°Ïpublic static final String keyString = "_ignoreEffectForTurn";°Ïpublic VolrathsCurse(UUID ownerId) {°Ïsuper(ownerId, 101, "Volrath's Curse", Rarity.COMMON, new CardType[]{CardType.ENCHANTMENT}, "{1}{U}");°Ïthis.expansionSetCode = "TMP";°Ïthis.subtype.add("Aura");°ÏTargetPermanent auraTarget = new TargetCreaturePermanent();°Ïthis.getSpellAbility().addTarget(auraTarget);°Ïthis.getSpellAbility().addEffect(new AttachEffect(Outcome.BoostCreature));°ÏAbility ability = new EnchantAbility(auraTarget.getTargetName());°Ïthis.addAbility(ability);°Ïability = new SimpleStaticAbility(Zone.BATTLEFIELD, new VolrathsCurseRestrictionEffect());°Ïability.addEffect(new VolrathsCurseCantActivateAbilitiesEffect());°Ïthis.addAbility(ability);°Ïthis.addAbility(new VolrathsCurseSpecialAction());°Ïthis.addAbility(new SimpleActivatedAbility(Zone.BATTLEFIELD, new ReturnToHandSourceEffect(true), new ManaCostsImpl("{1}{U}")));°Ï}°Ïpublic VolrathsCurse(final VolrathsCurse card) {°Ïsuper(card);°Ï}°Ï@Override°Ïpublic VolrathsCurse copy() {°Ïreturn new VolrathsCurse(this);°Ï}°Ï}°Ïclass VolrathsCurseRestrictionEffect extends RestrictionEffect {°Ïpublic VolrathsCurseRestrictionEffect() {°Ïsuper(Duration.WhileOnBattlefield);°Ïthis.staticText = "Enchanted creature can't attack or block";°Ï}°Ïpublic VolrathsCurseRestrictionEffect(final VolrathsCurseRestrictionEffect effect) {°Ïsuper(effect);°Ï}°Ï@Override°Ïpublic boolean applies(Permanent permanent, Ability source, Game game) {°ÏPermanent attachment = game.getPermanent(source.getSourceId());°Ïif (attachment != null && attachment.getAttachedTo() != null°Ï&& permanent.getId().equals(attachment.getAttachedTo())) {°ÏString key = source.getSourceId().toString() + attachment.getZoneChangeCounter(game) + keyString + game.getTurnNum() + permanent.getControllerId();°Ïreturn game.getState().getValue(key) == null;°Ï}°Ïreturn false;°Ï}°Ï@Override°Ïpublic boolean canAttack(Game game) {°Ïreturn false;°Ï}°Ï@Override°Ïpublic boolean canBlock(Permanent attacker, Permanent blocker, Ability source, Game game) {°Ïreturn false;°Ï}°Ï@Override°Ïpublic VolrathsCurseRestrictionEffect copy() {°Ïreturn new VolrathsCurseRestrictionEffect(this);°Ï}°Ï}°Ïclass VolrathsCurseCantActivateAbilitiesEffect extends ContinuousRuleModifyingEffectImpl {°Ïpublic VolrathsCurseCantActivateAbilitiesEffect() {°Ïsuper(Duration.WhileOnBattlefield, Outcome.UnboostCreature);°ÏstaticText = ", and its activated abilities can't be activated";°Ï}°Ïpublic VolrathsCurseCantActivateAbilitiesEffect(final VolrathsCurseCantActivateAbilitiesEffect effect) {°Ïsuper(effect);°Ï}°Ï@Override°Ïpublic VolrathsCurseCantActivateAbilitiesEffect copy() {°Ïreturn new VolrathsCurseCantActivateAbilitiesEffect(this);°Ï}°Ï@Override°Ïpublic boolean apply(Game game, Ability source) {°Ïreturn true;°Ï}°Ï@Override°Ïpublic boolean checksEventType(GameEvent event, Game game) {°Ïreturn event.getType() == GameEvent.EventType.ACTIVATE_ABILITY;°Ï}°Ï@Override°Ïpublic boolean applies(GameEvent event, Ability source, Game game) {°ÏPermanent enchantment = game.getPermanent(source.getSourceId());°Ïif (enchantment != null && enchantment.getAttachedTo() != null) {°Ïif (event.getSourceId().equals(enchantment.getAttachedTo())) {°ÏPermanent enchanted = game.getPermanent(enchantment.getAttachedTo());°Ïif (enchanted != null) {°ÏString key = source.getSourceId().toString() + enchantment.getZoneChangeCounter(game) + keyString + game.getTurnNum() + enchanted.getControllerId();°Ïreturn game.getState().getValue(key) == null;°Ï}°Ï}°Ï}°Ïreturn false;°Ï}°Ï}°Ïclass VolrathsCurseSpecialAction extends SpecialAction {°Ïpublic VolrathsCurseSpecialAction() {°Ïsuper(Zone.BATTLEFIELD);°Ïthis.addCost(new SacrificeTargetCost(new TargetControlledPermanent(), true));°Ïthis.addEffect(new VolrathsCurseIgnoreEffect(keyString));°Ïthis.setMayActivate(TargetController.CONTROLLER_ATTACHED_TO);°Ï}°Ïpublic VolrathsCurseSpecialAction(final VolrathsCurseSpecialAction ability) {°Ïsuper(ability);°Ï}°Ï@Override°Ïpublic VolrathsCurseSpecialAction copy() {°Ïreturn new VolrathsCurseSpecialAction(this);°Ï}°Ï}°Ïclass VolrathsCurseIgnoreEffect extends OneShotEffect {°Ïpublic VolrathsCurseIgnoreEffect(final String keyString) {°Ïsuper(Outcome.Benefit);°Ïthis.staticText = "That creature's controller may sacrifice a permanent for that player to ignore this effect until end of turn";°Ï}°Ïpublic VolrathsCurseIgnoreEffect(final VolrathsCurseIgnoreEffect effect) {°Ïsuper(effect);°Ï}°Ï@Override°Ïpublic VolrathsCurseIgnoreEffect copy() {°Ïreturn new VolrathsCurseIgnoreEffect(this);°Ï}°Ï@Override°Ïpublic boolean apply(Game game, Ability source) {°ÏString key = source.getSourceId().toString() + source.getSourceObjectZoneChangeCounter() + keyString + game.getTurnNum() + ((ActivatedAbilityImpl)source).getActivatorId();°Ïgame.getState().setValue(key,true);°Ïreturn true;°Ï}°Ï}°Ï
