public class SpellRupture extends CardImpl {¡ìpublic SpellRupture(UUID ownerId) {¡ìsuper(ownerId, 52, "Spell Rupture", Rarity.COMMON, new CardType[]{CardType.INSTANT}, "{1}{U}");¡ìthis.expansionSetCode = "GTC";¡ìthis.getSpellAbility().addEffect(new SpellRuptureCounterUnlessPaysEffect());¡ìthis.getSpellAbility().addTarget(new TargetSpell());¡ì}¡ìpublic SpellRupture(final SpellRupture card) {¡ìsuper(card);¡ì}¡ì@Override¡ìpublic SpellRupture copy() {¡ìreturn new SpellRupture(this);¡ì}¡ì}¡ìclass SpellRuptureCounterUnlessPaysEffect extends OneShotEffect {¡ìpublic SpellRuptureCounterUnlessPaysEffect() {¡ìsuper(Outcome.Detriment);¡ì}¡ìpublic SpellRuptureCounterUnlessPaysEffect(final SpellRuptureCounterUnlessPaysEffect effect) {¡ìsuper(effect);¡ì}¡ì@Override¡ìpublic SpellRuptureCounterUnlessPaysEffect copy() {¡ìreturn new SpellRuptureCounterUnlessPaysEffect(this);¡ì}¡ì@Override¡ìpublic boolean apply(Game game, Ability source) {¡ìStackObject spell = game.getStack().getStackObject(targetPointer.getFirst(game, source));¡ìif (spell != null) {¡ìPlayer player = game.getPlayer(spell.getControllerId());¡ìPlayer controller = game.getPlayer(source.getControllerId());¡ìMageObject sourceObject = game.getObject(source.getSourceId());¡ìif (player != null && controller != null && sourceObject != null) {¡ìint amount = new greatestPowerCountCreatureYouControl().calculate(game, source, this);¡ìGenericManaCost cost = new GenericManaCost(amount);¡ìStringBuilder sb = new StringBuilder("Pay {").append(amount).append("}? (otherwise ").append(spell.getName()).append(" will be countered)");¡ìif (player.chooseUse(Outcome.Benefit, sb.toString(), source, game)) {¡ìcost.pay(source, game, source.getSourceId(), player.getId(), false);¡ì}¡ìif (!cost.isPaid()) {¡ìif (game.getStack().counter(source.getFirstTarget(), source.getSourceId(), game)) {¡ìgame.informPlayers(new StringBuilder(sourceObject.getName()).append(": cost wasn't payed - countering ").append(spell.getName()).toString());¡ìreturn true;¡ì}¡ì}¡ì}¡ì}¡ìreturn false;¡ì}¡ì@Override¡ìpublic String getText(Mode mode) {¡ìreturn "Counter target spell unless its controller pays {X}, where X is the greatest power among creatures you control";¡ì}¡ì}¡ìclass greatestPowerCountCreatureYouControl implements DynamicValue {¡ì@Override¡ìpublic int calculate(Game game, Ability sourceAbility, Effect effect) {¡ìint value = 0;¡ìfor (Permanent creature : game.getBattlefield().getActivePermanents(new FilterControlledCreaturePermanent(), sourceAbility.getControllerId(), game)) {¡ìif (creature != null && creature.getPower().getValue() > value) {¡ìvalue = creature.getPower().getValue();¡ì}¡ì}¡ìreturn value;¡ì}¡ì@Override¡ìpublic DynamicValue copy() {¡ìreturn new greatestPowerCount();¡ì}¡ì@Override¡ìpublic String toString() {¡ìreturn "X";¡ì}¡ì@Override¡ìpublic String getMessage() {¡ìreturn "greatest power among creatures you control";¡ì}¡ì}¡ì
